

#include "rfm_def.h"
#include "rfm.h"


/**********************************************************************
*
*		Defined
*
**********************************************************************/
#if 1	// old pattern
uint8_t RFM_PREAMBLE_DATA[RFM_PREAMBLE_LEN] = 
{
	0x00 ,0xFC ,0x0F ,0x00 ,0x00 ,0x00 ,0xFC ,0x0F ,0xFE ,0x07 ,0x1F ,0x7C ,0xF0 ,0xC1 ,0x07 ,0x00,
	0x80 ,0x0F ,0xFE ,0x07 ,0x00 ,0x80 ,0xFF ,0xC1 ,0xFF ,0x1F ,0x00 ,0xF0 ,0xC1 ,0xFF ,0x00 ,0x7C,
	0xF0 ,0xFF ,0x07 ,0x1F ,0xFC ,0xFF ,0x3F ,0x00 ,0xFF ,0x7F ,0x00 ,0xFE ,0xFF ,0x00 ,0x00 ,0xF0,
	0x01 ,0xF8 ,0xE0 ,0x03 ,0x00 ,0x00 ,0x00 ,0x1F ,0x7C ,0xF0 ,0xC1 ,0xFF ,0x00 ,0x80 ,0x0F ,0x3E,
	0xF8 ,0xFF ,0xFF ,0xFF ,0x3F ,0x00 ,0x1F ,0xFC ,0xFF ,0x3F ,0x00 ,0xFF ,0x83 ,0xFF ,0x3F ,0xF8,
	0xE0 ,0xFF ,0x0F ,0x00 ,0x00 ,0x1F ,0xFC ,0xFF ,0xFF ,0x07 ,0x00 ,0x80 ,0x0F ,0x00 ,0xF8 ,0xE0,
	0x03 ,0x00 ,0x00 ,0x00 ,0xE0 ,0x03 ,0x00 ,0x3E ,0x00 ,0x00 ,0xFC ,0xFF ,0x01 ,0x00 ,0x1F ,0x80,
	0xFF ,0x01 ,0xF8 ,0xFF ,0x83 ,0x0F ,0xFE ,0x07 ,0x1F ,0x7C ,0x00 ,0x00 ,0xF8 ,0x1F ,0x80 ,0xFF,
	0xFF ,0xFF ,0xFF ,0xFF ,0x0F ,0x3E ,0xF8 ,0xFF ,0xFF ,0x0F ,0x00 ,0xF8 ,0x00 ,0xFC ,0xFF ,0xFF,
	0xFF ,0xFF ,0x83 ,0xFF ,0x01 ,0xF8 ,0x00 ,0x00 ,0x00 ,0xFE ,0xFF ,0xE0 ,0x83 ,0xFF ,0xFF ,0xFF,
	0xE0 ,0x83 ,0xFF ,0x3F ,0x00 ,0x00 ,0x00 ,0xF0 ,0xFF ,0xFF ,0xE0 ,0xFF ,0x0F ,0x00 ,0xF8 ,0xE0,
	0x7F ,0x00 ,0x3E ,0xF8 ,0xE0 ,0x03 ,0x00 ,0x00 ,0xF8 ,0xFF ,0xFF ,0x0F ,0xFE ,0x07 ,0xFF ,0xFF,
	0x0F ,0x00 ,0x00 ,0x1F ,0xFC ,0x0F ,0xC0 ,0xFF ,0x1F ,0x7C ,0x00 ,0x3E ,0x00 ,0xE0 ,0x7F ,0x00,
	0x00 ,0xF8 ,0xFF ,0x83 ,0xFF ,0x01 ,0xF8 ,0xE0 ,0x7F ,0x00 ,0x00 ,0x00 ,0xE0 ,0xFF ,0x0F ,0x3E,
	0x00 ,0x00 ,0x7C ,0x00 ,0xFE ,0x07 ,0x1F ,0x7C ,0xF0 ,0x3F ,0xF8 ,0x1F ,0xFC ,0x0F ,0x00 ,0xF8,
	0x1F ,0x80 ,0xFF ,0x3F ,0xF8 ,0xE0 ,0xFF ,0x0F ,0x3E ,0xF8 ,0xFF ,0x7F ,0xF0 ,0x3F ,0xF8 ,0xFF,
	0x7F ,0xF0 ,0xFF ,0x07 ,0x00 ,0x00 ,0x00 ,0x3E ,0xF8 ,0xE0 ,0x83 ,0x0F ,0x00 ,0xF8 ,0x1F ,0x7C,
	0xF0 ,0xFF ,0xFF ,0x1F ,0xFC ,0xFF ,0xFF ,0xFF ,0x00 ,0xFC ,0xFF ,0x3F ,0xF8 ,0xFF ,0x03 ,0xF0,
	0xFF ,0xFF ,0xFF ,0x7F ,0xF0 ,0x3F ,0xF8 ,0x00 ,0x80 ,0xFF ,0xC1 ,0x07 ,0xE0 ,0x03 ,0xF0 ,0xC1,
	0xFF ,0xFF ,0x03 ,0x00 ,0x3E ,0x00 ,0x1F ,0x7C ,0x00 ,0x3E ,0x00 ,0xFF ,0xFF ,0x0F ,0xC0 ,0x07,
	0x1F ,0x7C ,0x00 ,0x3E ,0x00 ,0x00 ,0x7C ,0x00 ,0xC0 ,0xFF ,0x1F ,0xFC ,0x0F ,0xFE ,0xFF ,0xFF,
	0xFF ,0xFF ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0xC0 ,0xFF ,0x1F ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xFC,
	0xFF ,0x3F ,0x00 ,0xE0 ,0x03 ,0x00 ,0xC0 ,0x07 ,0x1F ,0x7C ,0x00 ,0x3E ,0x00 ,0xFF ,0x03 ,0x00,
	0xFE ,0xFF ,0xFF ,0x83 ,0x0F ,0xFE ,0xFF ,0xE0 ,0xFF ,0x0F ,0xC0 ,0x07 ,0xE0 ,0x03 ,0xF0 ,0x01,
	0xF8 ,0xE0 ,0x03 ,0x00 ,0x3E ,0x00 ,0xE0 ,0x7F ,0xF0 ,0xFF ,0x07 ,0xFF ,0x03 ,0xF0 ,0xFF ,0xFF,
	0xFF ,0x7F ,0xF0 ,0xFF ,0xFF ,0xE0 ,0xFF ,0xFF ,0x01 ,0x00 ,0x00 ,0x80 ,0x0F ,0x00 ,0xF8 ,0x00,
	0xFC ,0xFF ,0x3F ,0x00 ,0xFF ,0x7F ,0x00 ,0x3E ,0x00 ,0xE0 ,0xFF ,0x0F ,0x00 ,0x00 ,0x00 ,0x00,
	0x00 ,0xFE ,0x07 ,0xFF ,0xFF ,0x0F ,0x3E ,0x00 ,0x1F ,0x00 ,0xF0 ,0x3F ,0xF8 ,0x00 ,0x00 ,0x00,
	0x00 ,0x00 ,0x00 ,0x80 ,0x0F ,0xC0 ,0xFF ,0x1F ,0x00 ,0x00 ,0x3E ,0x00 ,0x1F ,0x80 ,0xFF ,0xFF,
	0x07 ,0x00 ,0x7C ,0xF0 ,0x01 ,0xF8 ,0xE0 ,0x03 ,0x00 ,0xC0 ,0xFF ,0xE0 ,0xFF ,0x0F ,0x00 ,0xF8,
	0xFF ,0x7F ,0x00 ,0xFE ,0x07 ,0xFF ,0xFF ,0x0F ,0x00 ,0xF8 ,0xE0 ,0x7F ,0x00 ,0x00 ,0x00 ,0xE0,
	0x83 ,0x0F ,0x00 ,0xF8 ,0x00 ,0x00 ,0xF0 ,0x01 ,0x00 ,0x00 ,0x7C ,0xF0 ,0xC1 ,0x07 ,0xE0 ,0xFF

};
#else
uint8_t RFM_PREAMBLE_DATA[RFM_PREAMBLE_LEN] = 
{
	0x6F, 0xF3, 0xCE, 0x96, 0xFE, 0xD5, 0x5F, 0xDA, 0xAD, 0x79, 0x15, 0xD6, 0x38, 0xB1, 0x62, 0xD6,
	0xB6, 0x67, 0x2F, 0x6D, 0x45, 0xFE, 0x9E, 0x9B, 0x6A, 0x5C, 0x79, 0x62, 0xB0, 0xDC, 0xF5, 0xE9,
	0x6E, 0x6B, 0x40, 0xAD, 0xBF, 0x9A, 0x21, 0x72, 0x3D, 0xAC, 0x7F, 0xDC, 0xAC, 0xA2, 0x57, 0x66,
	0xFD, 0x17, 0x18, 0x43, 0xE1, 0xFB, 0x9C, 0x15, 0xAD, 0x2F, 0x97, 0x09, 0x81, 0x99, 0x51, 0xEC,
	0x11, 0x01, 0x67, 0x1F, 0x0C, 0xEC, 0x46, 0x42, 0xF4, 0x40, 0xAF, 0xDA, 0xCA, 0x44, 0xBC, 0xFC,
	0x2E, 0xC3, 0xD7, 0x19, 0xA0, 0x3E, 0xD9, 0xB3, 0xB0, 0xE4, 0x78, 0x21, 0xAF, 0xB5, 0xCD, 0xF5,
	0xF9, 0x23, 0x4D, 0x1C, 0x05, 0x79, 0x04, 0x7E, 0x1A, 0x23, 0x54, 0x7B, 0x59, 0x10, 0xEE, 0xBD,
	0xE3, 0x13, 0x08, 0xE2, 0x06, 0x7D, 0x6C, 0xB8, 0x73, 0x3D, 0x3B, 0x6F, 0x03, 0xA2, 0x88, 0x75,
	0x9F, 0xF5, 0xFC, 0xF4, 0x8B, 0x0D, 0xE1, 0xDA, 0x1B, 0x3F, 0xCE, 0x07, 0x3A, 0x2F, 0x06, 0x8A,
	0x22, 0x76, 0x9F, 0x2B, 0x18, 0x05, 0xEA, 0xEC, 0x22, 0xC5, 0xB4, 0x97, 0xB6, 0x17, 0x97, 0xC7,
	0x0D, 0x60, 0xF7, 0x93, 0x2A, 0x88, 0x75, 0x27, 0x99, 0xF4, 0x46, 0x6A, 0xC3, 0x05, 0xC0, 0xFF,
	0x5F, 0x60, 0x29, 0x39, 0x7A, 0xA0, 0x56, 0x8B, 0x65, 0x58, 0x9F, 0x19, 0x1B, 0xAB, 0x9D, 0x35,
	0x6E, 0xCE, 0x80, 0x3F, 0x1C, 0x2F, 0xFF, 0xA5, 0x04, 0x7C, 0x25, 0x74, 0x2C, 0x04, 0x5A, 0x19,
	0x30, 0xC4, 0x5A, 0xB2, 0x47, 0xC7, 0x09, 0x60, 0x16, 0x56, 0x70, 0x22, 0x2A, 0x70, 0x9F, 0xB1,
	0x0A, 0x6B, 0x0F, 0x1A, 0xA5, 0x1B, 0x2D, 0x37, 0x5F, 0xBF, 0x49, 0x10, 0x2D, 0x12, 0x79, 0xBA,
	0x33, 0x51, 0x52, 0xDA, 0x67, 0x37, 0xD2, 0xF7, 0xA5, 0x7E, 0xC4, 0x5A, 0xE7, 0x89, 0x3C, 0x0C,
	0x37, 0x14, 0xA9, 0x7C, 0x88, 0x48, 0x85, 0xF5, 0x30, 0x9B, 0x0F, 0xEF, 0x13, 0xC7, 0x37, 0x6B,
	0x62, 0x91, 0x1A, 0xB7, 0x25, 0x30, 0x3C, 0x0C, 0xB4, 0xA3, 0x44, 0xB2, 0x2C, 0x52, 0xD2, 0x95,
	0xA3, 0xD5, 0xBF, 0x3C, 0xD0, 0x20, 0xC2, 0xA7, 0xCD, 0xD3, 0x68, 0xCB, 0x4A, 0xA0, 0xF1, 0x4E,
	0x1D, 0xD5, 0x0A, 0xD1, 0xDE, 0x94, 0x31, 0x68, 0x14, 0x0F, 0xA7, 0x3D, 0xCA, 0x0C, 0xEC, 0xBE,
	0x20, 0xE0, 0xA7, 0xE4, 0xB1, 0xDB, 0x2E, 0x3C, 0xC8, 0x40, 0xF1, 0x15, 0xBA, 0x58, 0xA5, 0x55,
	0xD7, 0x1F, 0x33, 0x42, 0x38, 0x57, 0x55, 0x14, 0x74, 0x47, 0xB0, 0x53, 0x08, 0x1D, 0x6A, 0x6F,
	0x88, 0xC5, 0x88, 0x8D, 0x8E, 0xAA, 0xAE, 0xE9, 0x78, 0x47, 0x2B, 0x2E, 0x2D, 0x24, 0x90, 0x00,
	0xD8, 0xAE, 0xE0, 0xE1, 0x64, 0x8F, 0xC4, 0x4F, 0xF6, 0x40, 0xD0, 0xF1, 0x81, 0xA5, 0x06, 0xDE,
	0x30, 0x9F, 0xD7, 0xD8, 0x95, 0xC1, 0xAB, 0x6A, 0x6B, 0xFA, 0x09, 0x4B, 0xA2, 0xEC, 0x61, 0x32,
	0xE4, 0xF6, 0x23, 0x56, 0x7E, 0xB3, 0x3E, 0xCE, 0xAB, 0xF1, 0x15, 0x74, 0xE5, 0xD4, 0x3C, 0xED,
	0xB7, 0xDA, 0xD3, 0xFB, 0x36, 0xD6, 0x98, 0x36, 0x70, 0x77, 0x91, 0xF1, 0x36, 0x58, 0x22, 0xA3,
	0xB3, 0xBB, 0xBB, 0x08, 0x5A, 0xFE, 0xCF, 0xB2, 0x81, 0x45, 0xFA, 0xAA, 0x68, 0xAC, 0xCE, 0x03,
	0x60, 0xC9, 0xDE, 0x61, 0x4A, 0xA2, 0xAA, 0x5F, 0x51, 0xEA, 0xCD, 0xBA, 0x7C, 0x1A, 0xD6, 0x30,
	0x22, 0x2A, 0x29, 0x33, 0x79, 0xDE, 0x58, 0xD5, 0xC5, 0x57, 0x4C, 0x69, 0x21, 0x2F, 0xBE, 0xF8,
	0xDF, 0xBA, 0x34, 0x9E, 0x20, 0x4E, 0x8C, 0x08, 0x52, 0x5C, 0x0F, 0x82, 0x41, 0xC8, 0x6B, 0x1C,
	0x03, 0x63, 0x9C, 0x58, 0x09, 0xB4, 0x0A, 0x10, 0xDE, 0x1F, 0xF3, 0x5A, 0x4F, 0x83, 0x93, 0x2C
};
#endif


#define my_ntohl(x) (long long)((((long long)(x) & 0x00000000000000ffL) << 56) | \
															(((long long)(x) & 0x000000000000ff00L) << 40) | \
															(((long long)(x) & 0x0000000000ff0000L) << 24) | \
															(((long long)(x) & 0x00000000ff000000L) << 8) | \
															(((long long)(x) & 0x000000ff00000000L) >> 8) | \
															(((long long)(x) & 0x0000ff0000000000L) >> 24) | \
															(((long long)(x) & 0x00ff000000000000L) >> 40) | \
															(((long long)(x) & 0xff00000000000000L) >> 56) )





#define RFM_TX_SEND_SIZE(a, b)			((RFM_PREAMBLE_LEN)*(a)+((RFM_DATA_LEN)*(BYTE_TO_BIT)*(b/8)))

#define RFM_DATA_FIELD_POS		(RFM_PREAMBLE_LEN)*(BYTE_TO_BIT)*(OVERSAMPLE_CNT)	// 2560

#define TX_DEBUG_PRNT		0

/**********************************************************************
*
*		Variable
*
**********************************************************************/
M_RFM_TX_INFO m_antTxInfo;

extern uint8_t PN_1[PN_LEN];
extern uint8_t PN_0[PN_LEN];

extern _ULP_FLASH_PARAM ulp_flash_param;

extern uint8_t rfm_preamble_cycle;

/**********************************************************************
*
*		RFM TX Funcions
*
**********************************************************************/
void RFM_TX_Init(void)
{		
	if(RFM_Set_TxDefaultRegister() == false)
	{
		printf("Fail RFM TX Default Setting\r\n");
		return;
	}

	WMO_Set_DataRate(ulp_flash_param.data_rate);

	rfm_preamble_cycle = (ulp_flash_param.duty_cycle == 0) ? 1 : ulp_flash_param.duty_cycle;

	RFM_TX_Resource_Init();

	Configure_EXTI_ADC_CLK();


	printf("\nSET FIRENZE RFM TX MODE : ");
	//printf("PREAMBLE_LENGTH = %d\n", RFM_PREAMBLE_LEN);
	printf("%d.%dKHz Data rate\n\n", (250 >> ulp_flash_param.data_rate), ((25000/(1<<ulp_flash_param.data_rate))%100));

}



void RFM_TX_Resource_Init(void)
{
	M_RFM_TX_INFO *t = &m_antTxInfo;

	t->bit_ptr = 7;
	t->byte_ptr = 0;
	t->len = 0;
	t->busy = false;

	if(ulp_flash_param.pn_len == 1)
		t->buffSize = (RFM_PREAMBLE_LEN)*(rfm_preamble_cycle)+(24+RFM_PRM_LEN);
	else
		t->buffSize = RFM_TX_SEND_SIZE(rfm_preamble_cycle, ulp_flash_param.pn_len);
	t->initialized = true;
}



int RFM_TX_Buff_In(char* data , int len)
{
	M_RFM_TX_INFO *t = &m_antTxInfo;
	int i, j, k;
	int p_i, pos=0;
	uint8_t convBit;
	uint8_t *pnPtr;

	if(t->initialized == false)
	{
		printf("[ULP Tx] ULP is not initialized\n");
		return 0;
	}
	
	if(len > t->buffSize)
	{
		printf("Error... Tx Buff size is over[%d:%d]\n", t->buffSize, len);
		return 0;
	}

	if(t->busy == true)
	{
		printf("Error... Tx Busy\n");
		return 0;
	}

	t->bit_ptr = 7;
	t->byte_ptr = 0;

	/* Allocate heap for tx buffer */
	t->buff = (uint8_t *)malloc(sizeof(uint8_t)*(t->buffSize));
	memset(t->buff, 0, t->buffSize);
	printf("Tx Buff size is [%d:%d]\n", t->buffSize, len);
	
	for(p_i=0; p_i < rfm_preamble_cycle; p_i++)
	{

		/* Copy Preamble to tx buffer */
		for(i = 0 ; i < RFM_PREAMBLE_LEN; i++)
		{
			//t->buff[i+(RFM_PREAMBLE_LEN*p_i)] = RFM_PREAMBLE_DATA[i];
			t->buff[pos++] = RFM_PREAMBLE_DATA[i];
		}
	}

	pos = (RFM_PREAMBLE_LEN * rfm_preamble_cycle);

	/* Prepared PN code to data buffer */
	for(i = 0 ; i < len; i++)
	{
		if(ulp_flash_param.pn_len == 1)
		{
			t->buff[pos] = data[i];
			pos++;
			continue;

		}

		for(j = 7 ; j >= 0; j--)
		{
			/* Get data per 1bit	*/
			convBit = ((data[i]>>j)&0x01);

			if(convBit > 0)	pnPtr = PN_1;
			else						pnPtr = PN_0;


			/* Convert 1bit data to PN code	and put data buffer*/
			for(k = 0 ; k < (ulp_flash_param.pn_len/8); k++)
			{
				t->buff[pos] |= *(pnPtr+(k*8));			t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+1);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+2);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+3);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+4);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+5);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+6);		t->buff[pos] <<= 1;
				t->buff[pos] |= *(pnPtr+(k*8)+7);		pos++;


			}
		}

	}

#if (0)

	/*
	printf("\n");
	for(i = 0 ; i < RFM_PREAMBLE_LEN; i++)
	{
		if(i != 0 && i % 16 == 0)	printf("\n");
		printf("0x%02x ", t->buff[i]);
	}
	printf("\n");
	
	printf("\n");
	for(i = RFM_PREAMBLE_LEN; i < pos; i++)
	{		
		j = i - RFM_PREAMBLE_LEN;
		//if(i != 0 && i % 16 == 0)	printf("\n");
		if(j != 0 && j % 8 == 0) printf(" ");
		if(j != 0 && j % 64 == 0) printf("\n");
		if(j != 0 && (j % (64*8) == 0)) printf("\n");
				
		printf("%x", t->buff[i]);
	}
	printf("\n");
	*/

	printf("\n");
	for(i = 0; i < pos; i++)
	{
		j = i;
		//if(i != 0 && i % 16 == 0)	printf("\n");
		if(j != 0 && j % 8 == 0) printf(" ");
		if(j != 0 && j % 64 == 0) printf("\n");
		if(j != 0 && (j % (64*8) == 0)) printf("\n");

		printf("%02x", t->buff[i]);
	}
	printf("\n");
#endif


	/* Add total length to send length */
	t->len = pos;


	printf("Tx Buff size is [%d:%d]\n", t->buffSize, t->len);
	/* Set busy flag */
	t->busy = true;

	FRZ_ADC_EXTI_LINE_ENABLE();

	return 1;
}



uint8_t RFM_TX_Buff_Out(uint8_t type)
{
	M_RFM_TX_INFO *t = &m_antTxInfo;;
	uint8_t outVal = 0x0;
	
	if(t->busy == true)
	{
		if(t->len == t->byte_ptr)
		{
			t->bit_ptr = 7;
			t->byte_ptr = 0;
			t->len = 0;
			t->busy = false;	
			return 2;
		}
		else
		{
			outVal = (t->buff[t->byte_ptr] >> t->bit_ptr) & 0x01;

			if(t->bit_ptr - 1 < 0)
			{
				t->bit_ptr = 7;
				t->byte_ptr++;
			}
			else
			{
				t->bit_ptr--;
			}
			
			return outVal;
		}
	}
	else
	{
		// No processing
	}

	return 0;
}



bool RFM_TX_Busy_Check(void)
{
	return (m_antTxInfo.busy);
}



void Configure_EXTI_ADC_CLK(void)
{
	GPIO_InitTypeDef GPIO_InitStruct = {0};

	GPIO_InitStruct.Pin = FRZ_ADC_CLK_Pin;
	GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	HAL_GPIO_Init(FRZ_RX_ADC_GPIO_Port, &GPIO_InitStruct);

	/* Enable and set EXTI lines 15 to 10 Interrupt to the highest priority */
	HAL_NVIC_SetPriority(FRZ_ADC_EXTI_IRQn, 0, 0);
	HAL_NVIC_EnableIRQ(FRZ_ADC_EXTI_IRQn);
	FRZ_ADC_EXTI_LINE_DISABLE();
	
}


#if defined(FEATURE_FIRENZE_TX_MODE)
void RFM_TX_IRQHANDLER(void)
{
	static uint32_t irqCnt = 0;
	static uint32_t tCnt = 0;
	int i;
	uint8_t txBit = 0;
	M_RFM_TX_INFO *t = &m_antTxInfo;

	if(__HAL_GPIO_EXTI_GET_IT(FRZ_ADC_CLK_Pin) != RESET)
	{
		if((irqCnt % OVERSAMPLE_CNT) == 0)
		{
			/*   Get data from tx buffer    */
			txBit = RFM_TX_Buff_Out(0);


	#if (TX_DEBUG_PRNT==1)
				if(irqCnt >= RFM_DATA_FIELD_POS)
				{
					if(tCnt != 0 && tCnt % 8 == 0)	printf(" ");
					if(tCnt != 0 && tCnt % 64 == 0)	printf("\n");
					if(tCnt != 0 && tCnt % (64*8) == 0)	printf("\n");
					printf("%x", txBit);
					tCnt++;
				}
	#endif

				if(txBit == 0)
				{
					/*   Set high('0') value to tx data line    */
					//HAL_GPIO_WritePin(FRZ_TX_GPIO_Port, FRZ_TX_DATA, GPIO_PIN_RESET);
					HAL_GPIO_WritePin(FRZ_TX_GPIO_Port, FRZ_TX_DATA, GPIO_PIN_SET);
				}
				else if(txBit == 1)
				{
					/*   Set low('1') value to tx data line    */
					//HAL_GPIO_WritePin(FRZ_TX_GPIO_Port, FRZ_TX_DATA, GPIO_PIN_SET);
					HAL_GPIO_WritePin(FRZ_TX_GPIO_Port, FRZ_TX_DATA, GPIO_PIN_RESET);
				}
				else if(txBit == 2)
				{
					FRZ_ADC_EXTI_LINE_DISABLE();

					/* Release heap for tx buffer */
					free(t->buff);

					irqCnt = 0;
					printf("TX OK!!!\r\n");

//					RFM_PA_Off();

					/* Go to StandBy mode */
					//EnterStandbyMode();
				}
				else
				{
					irqCnt = 0;
					printf("Invalid Value : %02d\n", txBit);
				}

				
		}

		irqCnt++;

		__HAL_GPIO_EXTI_CLEAR_IT(FRZ_ADC_CLK_Pin);
	}

}
#endif

